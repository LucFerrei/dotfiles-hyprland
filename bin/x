#!/usr/bin/env bash
CONFIG_FILE="/home/lucas/tmx/tmx.conf"
declare -a WINDOWS
declare -a COMMANDS
# WINDOWS=("")
# COMMANDS=()

# have_config() {
#     if [ -f "$CONFIG_FILE" ]; then
# 	return 0
#     else
# 	return 1
#     fi
# }
#
# in_tmux() {
#     if [ -z $TMUX ]; then
# 	return 0
#     else
# 	return 1
#     fi
# }
# valid_path() {
#     path=$1
#
#     if [[ -e  $path ]]; then
# 	return 0
#     else
# 	return 1
#     fi
# }
#
# # have_config 
# # in_tmux 
# path=$(valid_path "/home/lucas/tmx/")
#
# if [[ $(have_config ) != 0 || $(is_tmux) != 0 || $(path) != 0 ]]; then
#     echo "Algum processo falhou"
# else 
#     echo "deu tudo certo!"
# fi
#
#read .sessionizer.conf
has_sessionizer() {
    path=$1
    
    if [ -f "$path/.sessionizer.conf" ]; then
	echo "Tem arquivo"
	return 0
    else
	echo "Não tem arquivo"
	return 1
    fi
} 
get_attribute() {
    attribute=$1
    path="$2"
    echo "path inside attribute $path"

    if has_sessionizer $path; then
	raw_value=$(grep "^$attribute=" "$path/.sessionizer.conf" | cut -d'=' -f2)
	content="${raw_value:1:-1}"
	if [ $attribute == "windows" ]; then
	    read -r -a WINDOWS <<< "$content"
	else
	    read -r -a COMMANDS <<< "$content"
	fi
    else
	:
    fi
}
#
# has_sessionizer "/home/lucas/personal/dotfiles-hyprland/bin"
# attribute="windows"

# echo "^$attribute="
# get_attribute "commands" $path
# for comm in $COMMANDS; do
#     if [[ $comm == "" ]]; then
# 	echo "sem comando"
# 	continue
#     else
# 	echo "eval"
# 	eval $comm
#     fi
# done
path="/home/lucas/personal/dotfiles-hyprland"
session="personal/dotfiles-hyprland"
# get_attribute "windows" $path
get_attribute "commands" $path
# echo "Window ${WINDOWS[$i]}" 
echo "Elementos ${COMMANDS[@]}"

if [ ${#COMMANDS[@]} -eq 0 ]; then
    echo "O array está vazio."
else
    echo "O array foi carregado com ${#WINDOWS[@]} elementos."
fi

# if [[ $(get_attribute "windows" $path) || $(get_attribute "commands" $path) ]]; then

# if [[ $(get_attribute "windows" $path) || $(get_attribute "commands" $path) ]]; then
#     for i in "${!WINDOWS[@]}"; do
# 	echo "Window ${WINDOWS[$i]}" 
# 	echo "Command ${COMMANDS[$i]}"
# 	# tmux neww -d -n "${WINDOWS[$i]}" "${COMMANDS[$i]}"
#     done
# else
#     echo "nao executou"
# fi

# tmux attach-session -t "$session"
#
#
generate_session() {
    echo "personal/books"
    echo "personal/dotfiles-hyprland"
    echo "personal/wallpapers"
} 

remove_tmux_prefix() {
    local prefixed_session=$1
    echo $prefixed_session | cut -d' ' -f2
}
fzf_tmux() {
    {
	tmux list-sessions -F "#{session_last_attached} [TMUX] #S" | sort -rn | cut -d' ' -f2-
	generate_session
    } | fzf 
}

fzf_tmux


# remove_tmux_prefix "[TMUX] personal/books"
